{
  "entities": {
    "UserProfile": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "UserProfile",
      "type": "object",
      "description": "Represents a user's profile in the SafePath Fitness app.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the UserProfile entity."
        },
        "name": {
          "type": "string",
          "description": "User's full name."
        },
        "email": {
          "type": "string",
          "description": "User's email address.",
          "format": "email"
        },
        "fitnessLevel": {
          "type": "string",
          "description": "User's self-assessed fitness level (e.g., beginner, intermediate, advanced)."
        },
        "fitnessGoals": {
          "type": "string",
          "description": "User's fitness goals (e.g., weight loss, muscle gain, general fitness)."
        }
      },
      "required": [
        "id",
        "name",
        "email",
        "fitnessLevel",
        "fitnessGoals"
      ]
    },
    "WorkoutPlan": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "WorkoutPlan",
      "type": "object",
      "description": "Represents a personalized workout plan generated for a user.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the WorkoutPlan entity."
        },
        "userProfileId": {
          "type": "string",
          "description": "Reference to UserProfile. (Relationship: UserProfile 1:N WorkoutPlan)"
        },
        "name": {
          "type": "string",
          "description": "Name of the workout plan (e.g., 'Beginner Full Body', 'Intermediate Strength')."
        },
        "description": {
          "type": "string",
          "description": "Description of the workout plan."
        },
        "createdAt": {
          "type": "string",
          "description": "Date and time the workout plan was created.",
          "format": "date-time"
        }
      },
      "required": [
        "id",
        "userProfileId",
        "name",
        "description",
        "createdAt"
      ]
    },
    "Exercise": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Exercise",
      "type": "object",
      "description": "Represents a specific exercise in a workout plan.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the Exercise entity."
        },
        "name": {
          "type": "string",
          "description": "Name of the exercise (e.g., 'Squats', 'Push-ups')."
        },
        "description": {
          "type": "string",
          "description": "Description of the exercise and proper form."
        },
        "videoUrl": {
          "type": "string",
          "description": "URL of the exercise execution video.",
          "format": "uri"
        }
      },
      "required": [
        "id",
        "name",
        "description",
        "videoUrl"
      ]
    },
    "WorkoutExercise": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "WorkoutExercise",
      "type": "object",
      "description": "Represents an exercise within a workout, and how it should be performed.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the WorkoutExercise entity."
        },
        "workoutPlanId": {
          "type": "string",
          "description": "Reference to WorkoutPlan. (Relationship: WorkoutPlan 1:N WorkoutExercise)"
        },
        "exerciseId": {
          "type": "string",
          "description": "Reference to Exercise. (Relationship: Exercise 1:N WorkoutExercise)"
        },
        "sets": {
          "type": "number",
          "description": "Number of sets for the exercise."
        },
        "reps": {
          "type": "number",
          "description": "Number of repetitions for each set."
        }
      },
      "required": [
        "id",
        "workoutPlanId",
        "exerciseId",
        "sets",
        "reps"
      ]
    },
    "ExerciseLog": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "ExerciseLog",
      "type": "object",
      "description": "Represents a log of a user performing an exercise on a specific date.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the ExerciseLog entity."
        },
        "userProfileId": {
          "type": "string",
          "description": "Reference to UserProfile. (Relationship: UserProfile 1:N ExerciseLog)"
        },
        "workoutExerciseId": {
          "type": "string",
          "description": "Reference to WorkoutExercise. (Relationship: WorkoutExercise 1:N ExerciseLog)"
        },
        "date": {
          "type": "string",
          "description": "Date the exercise was performed.",
          "format": "date-time"
        },
        "weight": {
          "type": "number",
          "description": "Weight used for the exercise (if applicable)."
        }
      },
      "required": [
        "id",
        "userProfileId",
        "workoutExerciseId",
        "date"
      ]
    }
  },
  "auth": {
    "providers": [
      "password",
      "anonymous",
      "google.com"
    ]
  },
  "firestore": {
    "structure": [
      {
        "path": "/users/{userId}/profile",
        "definition": {
          "entityName": "UserProfile",
          "schema": {
            "$ref": "#/backend/entities/UserProfile"
          },
          "description": "Stores user profile information. Accessible only by the user with matching userId.",
          "params": [
            {
              "name": "userId",
              "description": "The unique identifier for the user."
            }
          ]
        }
      },
      {
        "path": "/users/{userId}/workoutPlans/{workoutPlanId}",
        "definition": {
          "entityName": "WorkoutPlan",
          "schema": {
            "$ref": "#/backend/entities/WorkoutPlan"
          },
          "description": "Stores workout plans for a specific user. Accessible only by the user with matching userId.",
          "params": [
            {
              "name": "userId",
              "description": "The unique identifier for the user."
            },
            {
              "name": "workoutPlanId",
              "description": "The unique identifier for the workout plan."
            }
          ]
        }
      },
      {
        "path": "/exercises/{exerciseId}",
        "definition": {
          "entityName": "Exercise",
          "schema": {
            "$ref": "#/backend/entities/Exercise"
          },
          "description": "Stores a global catalog of exercises.  No ownership restrictions; read access may be public.",
          "params": [
            {
              "name": "exerciseId",
              "description": "The unique identifier for the exercise."
            }
          ]
        }
      },
      {
        "path": "/users/{userId}/workoutPlans/{workoutPlanId}/workoutExercises/{workoutExerciseId}",
        "definition": {
          "entityName": "WorkoutExercise",
          "schema": {
            "$ref": "#/backend/entities/WorkoutExercise"
          },
          "description": "Stores workout exercises for a specific workout plan, owned by a specific user. Accessible only by the user with matching userId.",
          "params": [
            {
              "name": "userId",
              "description": "The unique identifier for the user."
            },
            {
              "name": "workoutPlanId",
              "description": "The unique identifier for the workout plan."
            },
            {
              "name": "workoutExerciseId",
              "description": "The unique identifier for the workout exercise."
            }
          ]
        }
      },
      {
        "path": "/users/{userId}/exerciseLogs/{exerciseLogId}",
        "definition": {
          "entityName": "ExerciseLog",
          "schema": {
            "$ref": "#/backend/entities/ExerciseLog"
          },
          "description": "Stores exercise logs for a specific user. Accessible only by the user with matching userId.",
          "params": [
            {
              "name": "userId",
              "description": "The unique identifier for the user."
            },
            {
              "name": "exerciseLogId",
              "description": "The unique identifier for the exercise log."
            }
          ]
        }
      }
    ],
    "reasoning": "The Firestore structure is designed to ensure data isolation and facilitate secure access based on user ownership. Each user's data (profile, workout plans, exercises logs) is stored under their respective user ID, enabling path-based security rules. This eliminates the need for complex queries and ensures that users can only access their own data. The structure prioritizes simplicity for the user, which the design intends to reflect by being easily understood for simple data manipulation and querying.\n\n*   **Authorization Independence:** Achieved by structuring data around user-owned paths (`/users/{userId}`). Each user's data resides within their own document or subcollection, removing the need to `get()` parent document data to determine access. The `userProfileId` field in subcollections is not strictly for authorization, but rather data integrity and querying.\n*   **QAPs (Rules are not Filters):** Secure list operations are supported by the path-based ownership model. Rules can easily restrict list operations to only the current user's data (e.g., `list` all workout plans where `request.auth.uid == userId`)."
  }
}