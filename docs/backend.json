{
  "entities": {
    "UserProfile": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "UserProfile",
      "type": "object",
      "description": "Represents a user profile in the SafePath Fitness application.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the user profile."
        },
        "name": {
          "type": "string",
          "description": "User's full name."
        },
        "email": {
          "type": "string",
          "description": "User's email address.",
          "format": "email"
        },
        "fitnessLevel": {
          "type": "string",
          "description": "User's current fitness level (e.g., beginner, intermediate, advanced)."
        },
        "fitnessGoals": {
          "type": "string",
          "description": "User's fitness goals (e.g, weight loss, muscle gain)"
        }
      },
      "required": [
        "id",
        "name",
        "email",
        "fitnessLevel",
        "fitnessGoals"
      ]
    },
    "WorkoutPlan": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "WorkoutPlan",
      "type": "object",
      "description": "Represents a workout plan generated for a user.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the workout plan."
        },
        "userProfileId": {
          "type": "string",
          "description": "Reference to UserProfile. (Relationship: UserProfile 1:N WorkoutPlan)"
        },
        "name": {
          "type": "string",
          "description": "Name of the workout plan."
        },
        "description": {
          "type": "string",
          "description": "Description of the workout plan."
        }
      },
      "required": [
        "id",
        "userProfileId",
        "name",
        "description"
      ]
    },
    "Exercise": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Exercise",
      "type": "object",
      "description": "Represents an exercise in a workout plan.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the exercise."
        },
        "name": {
          "type": "string",
          "description": "Name of the exercise."
        },
        "description": {
          "type": "string",
          "description": "Description of the exercise."
        },
        "videoUrl": {
          "type": "string",
          "description": "URL of the exercise video.",
          "format": "uri"
        }
      },
      "required": [
        "id",
        "name",
        "description",
        "videoUrl"
      ]
    },
    "WorkoutLog": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "WorkoutLog",
      "type": "object",
      "description": "Represents a log of a user's workout session.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the workout log."
        },
        "userProfileId": {
          "type": "string",
          "description": "Reference to UserProfile. (Relationship: UserProfile 1:N WorkoutLog)"
        },
        "workoutPlanId": {
          "type": "string",
          "description": "Reference to WorkoutPlan. (Relationship: WorkoutPlan 1:N WorkoutLog)"
        },
        "exerciseId": {
          "type": "string",
          "description": "Reference to Exercise. (Relationship: Exercise 1:N WorkoutLog)"
        },
        "date": {
          "type": "string",
          "description": "Date of the workout session.",
          "format": "date-time"
        },
        "sets": {
          "type": "number",
          "description": "Number of sets performed."
        },
        "reps": {
          "type": "number",
          "description": "Number of repetitions performed."
        }
      },
      "required": [
        "id",
        "userProfileId",
        "workoutPlanId",
        "exerciseId",
        "date",
        "sets",
        "reps"
      ]
    }
  },
  "auth": {
    "providers": [
      "password",
      "anonymous"
    ]
  },
  "firestore": {
    "structure": [
      {
        "path": "/users/{userId}",
        "definition": {
          "entityName": "UserProfile",
          "schema": {
            "$ref": "#/backend/entities/UserProfile"
          },
          "description": "Stores user profile data.  Accessible only by the user with matching userId. This ensures that users can only access their own profile data.",
          "params": [
            {
              "name": "userId",
              "description": "The unique identifier for the user."
            }
          ]
        }
      },
      {
        "path": "/users/{userId}/workoutPlans/{workoutPlanId}",
        "definition": {
          "entityName": "WorkoutPlan",
          "schema": {
            "$ref": "#/backend/entities/WorkoutPlan"
          },
          "description": "Stores workout plans created by a user. Accessible only by the user with matching userId, via path-based ownership. The workoutPlanId uniquely identifies each plan within the user's collection.",
          "params": [
            {
              "name": "userId",
              "description": "The unique identifier for the user."
            },
            {
              "name": "workoutPlanId",
              "description": "The unique identifier for the workout plan."
            }
          ]
        }
      },
      {
        "path": "/exercises/{exerciseId}",
        "definition": {
          "entityName": "Exercise",
          "schema": {
            "$ref": "#/backend/entities/Exercise"
          },
          "description": "Stores exercise information.  Exercises are global and read-only. This supports QAPs as the app doesn't have to evaluate specific security rule logic for listing exercises.",
          "params": [
            {
              "name": "exerciseId",
              "description": "The unique identifier for the exercise."
            }
          ]
        }
      },
      {
        "path": "/users/{userId}/workoutLogs/{workoutLogId}",
        "definition": {
          "entityName": "WorkoutLog",
          "schema": {
            "$ref": "#/backend/entities/WorkoutLog"
          },
          "description": "Stores workout logs for a user. Accessible only by the user with matching userId, via path-based ownership. The workoutLogId uniquely identifies each workout log within the user's collection.",
          "params": [
            {
              "name": "userId",
              "description": "The unique identifier for the user."
            },
            {
              "name": "workoutLogId",
              "description": "The unique identifier for the workout log."
            }
          ]
        }
      }
    ],
    "reasoning": "The Firestore data structure is designed to provide a secure and scalable solution for the SafePath Fitness application, focusing on simplicity and clarity for beginner users. The design adheres to the principles of Authorization Independence, Structural Segregation, Access Modeling, and Data Clarity.\n\n**Authorization Independence:**\nUser-specific data is stored under the `/users/{userId}` path, ensuring that access control can be enforced based solely on the authenticated user's ID (`request.auth.uid`). The `UserProfile` data acts as the root for user-owned data. There are no denormalized authorization fields in `UserProfile`, as it is private data for each user. All subcollections are accessed using path-based ownership, ensuring atomic operations and clear authorization rules.\n\n**Structural Segregation:**\nThe database structure segregates data based on ownership. User profiles, workout plans, and workout logs are all stored under their respective user IDs. This separation ensures that each collection has a homogeneous security posture. For example, `/users/{userId}/workoutPlans/{workoutPlanId}` stores workout plans specific to a user, simplifying security rules because every document in the `workoutPlans` collection shares the same access control requirements.\n\n**Access Modeling:**\nPath-based ownership is used consistently throughout the structure.  Each user owns their `WorkoutPlan` and `WorkoutLog` documents, established by nesting them under the `/users/{userId}` path. This approach simplifies rules: only the authenticated user (`request.auth.uid`) has access to their own data.\n\n**QAPs (Rules are not Filters):**\nThe structure supports secure `list` operations. Because data is segregated by user, listing workout plans or workout logs only requires checking that the authenticated user ID matches the user ID in the path (`request.auth.uid == userId`). This prevents the need for filtering based on document content, which is an anti-pattern.\n\nIn summary, the recommended structure promotes clear, secure, and maintainable security rules by leveraging path-based ownership and avoiding complex hierarchical dependencies."
  }
}